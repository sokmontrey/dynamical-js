<html>
  <head>
    <meta charset="utf-8" />
    <title>Angle Constraint</title>
  </head>
  <body>
    <canvas width="500" height="500" id="canvas"></canvas>
    <script type="module">
      import {
        AngleConstraint,
        DistanceConstraint,
        Container,
        PointMass,
        Renderer,
        Vector,
      } from "../index.js";

      const canvas = document.getElementById("canvas");
      const renderer = new Renderer(canvas);
      renderer.setBackgroundColor("black");

      /*TODO:
      - [x] organized pointmasses
      - [x] calculate angle
      - [x] angle constraint
      - [] stiffness
      - [] propotional to mass
      - [] propotional to distance (maybe)

      TEST CASES:
      - [] three points
      */

      const p1 = new PointMass(100, 150);
      const p2 = new PointMass(200, 100);
      const p3 = new PointMass(230, 200);

      const s1 = new DistanceConstraint(p1, p2);
      const s2 = new DistanceConstraint(p2, p3);

      const c1 = new AngleConstraint(s1, s2);
      const container = new Container([p1, p2, p3]);

      renderer.loop((dt) => {
        renderer.clear();

        p1.applyForce(new Vector(0, 9));
        p2.applyForce(new Vector(0, 9));
        p3.applyForce(new Vector(0, 9));

        for (let i = 0; i < 10; i++) {
          s1.update(10);
          s2.update(10);
          container.update(10);
          c1.update(10);

          p1.updatePosition(0.25, 10);
          p2.updatePosition(0.25, 10);
          p3.updatePosition(0.25, 10);
        }

        renderer.draw(s1);
        renderer.draw(s2);
        renderer.draw(p1);
        renderer.draw(p2);
        renderer.draw(p3);
      });
    </script>
  </body>
</html>
