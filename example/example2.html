<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example2</title>

    <!-- <script src="https://cdn.jsdelivr.net/gh/sokmontrey/dynamical-vector@master/dynamical-vector.min.js"></script> -->
    <script src="../src/util/dynamical_vector.js"></script>

    <style>
        body{
            background-color: #191c22;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script type="module">
        import Renderer from '../src/renderer.js';
        import PointMass from '../src/point_mass.js';
        import {DistanceConstraint, SpringConstraint, ContainerConstraint, BoxContainerConstraint, CircleContainerConstraint} from '../src/constraint.js';

        const canvas = document.getElementById('canvas');
        const renderer = new Renderer(canvas);

        renderer.setBackground('#2E3440');

        const square = [
            new PointMass(renderer.CENTER.add(new Vector2(100, -50))),
            new PointMass(renderer.CENTER.add(new Vector2(150,0))),
            new PointMass(renderer.CENTER.add(new Vector2(100, 50))),
            new PointMass(renderer.CENTER.add(new Vector2(50, 0))),
        ];

        const square_structure = new DistanceConstraint([...square, square[0], square[2], square[3], square[1]], {record_tension: true});

        // const canvas_container = new BoxContainerConstraint(500, 500, square);
        const canvas_container = new CircleContainerConstraint(250, square);

        renderer.update(({delta_time, context:c})=>{
            renderer.clear();

            for(let i=0; i<square.length; i++){
                square[i].applyGravity(0, 9.8);
            }

            for(let i=0; i<3; i++){
                square_structure.check();
                canvas_container.check();

                for(let j=0; j<square.length; j++){
                    square[j].updatePosition(delta_time*0.55);
                }
            }

            renderer.polygon(square, {fill:"#D08770"});

            const constraints = square_structure.getConstraint();
            for(let each of constraints){
                renderer.line(each.point1.position, each.point2.position, 0,{stroke: `rgb(${each.tension * 255}, 0,0)`});
            }
        });
                        
    </script>
</body>
</html>
