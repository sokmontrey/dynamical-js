<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example2</title>

    <style>
        body{
            background-color: #191c22;
        }
        h2{
            color:white;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <h2 id="a1">X</h2>
    <h2 id="a2">Y</h2>
    <h2 id="a3">Z</h2>

    <script type="module">
        import { Vector } from '../src/util/dynamical_vector.js';
        import PointMass from '../src/dynamical/point_mass.js';
        import Renderer from '../src/util/renderer.js';
        import Constraint, { Container, CircleContainer } from '../src/dynamical/constraint.js';
        import Composite, {Rectangle} from '../src/dynamical/composite.js';
        import Collider from '../src/collision/collider.js';

        const g = new Vector(0,0);
        const acl = new Accelerometer({ frequency: 60 });
        acl.addEventListener("reading", () => {
            g.x = -acl.x * 2;
            g.y = acl.y * 2;
        });

        acl.start();

        const canvas = document.getElementById('canvas');
        const renderer = new Renderer(canvas);

        renderer.setBackground('#252422');
        renderer.camera.changeFOVTo(1.5);
        renderer.camera.moveTo(new Vector(250,250));
        // renderer.camera.moveTo(new Vector(250, 250));

        const c = new CircleContainer().setName("ground");

        const cube1 = Composite.create('square', {
            position: new Vector(250, 100),
            angle: Math.PI/5,
        }).setName("cube1");

        const circle = Composite.create('circle', {
            radius: 20,
            position: new Vector(100, 100)
        });

        circle.setVelocity(new Vector(1, 0))

        const rect = new Rectangle(250, 250, 10, 20);
        rect.setVelocity(new Vector(0, -1));

        const point = new PointMass(250, 250);

        renderer.update(run);

        function run(delta_time){
            renderer.clear();

            //apply force
            //constraint
            //Container
            //collider
            //update position
            //draw

            delta_time /= 10;
            cube1.setGravity(g);
            circle.setGravity(g);
            rect.setGravity(g);
            for(let i=0; i<10; i++){
                cube1.applyGravity();
                circle.applyGravity();
                rect.applyGravity();
                point.applyGravity(g);

                cube1.applyConnections();
                rect.applyConnections();

                c.check(cube1);
                c.check(circle);
                c.check(rect);
                c.check(point);

                Collider.check(circle, cube1);
                Collider.check(circle, rect);
                Collider.check(rect, cube1);

                cube1.updatePosition(delta_time);
                circle.updatePosition(delta_time);
                rect.updatePosition(delta_time);
                point.updatePosition(delta_time);
            }

            // renderer.camera.moveTo(circle.getPosition());

            renderer.draw(cube1);
            renderer.draw(circle);
            renderer.draw(rect);
            renderer.draw(point);
            renderer.draw(c);
        }
    </script>
</body>
</html>
