<html>
	<head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Example</title>

        <!-- Include the CodeMirror CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.css">

        <!-- Include the Prism.js CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism.min.css" integrity="sha512-/mZ1FHPkg6EKcxo0fKXF51ak6Cr2ocgDi5ytaTBjsQZIH/RNs6GF6+oId/vPe3eJB836T36nXwVh/WBl/cWT4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <!-- Include the CodeMirror and Prism.js libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/codemirror.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.0/mode/javascript/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>

        <!--Codemirror theme-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/nord.min.css" integrity="sha512-sPc4jmw78pt6HyMiyrEt3QgURcNRk091l3dZ9M309x4wM2QwnCI7bUtsLnnWXqwBMECE5YZTqV6qCDwmC2FMVA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <script src="https://cdn.tailwindcss.com"></script>

		<style>
            @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');
			body{
				padding-top: 2rem;
				background-color: #2E3440;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			canvas{
                border-image: linear-gradient(#2E3440, #ffffff) 0.5;
                border-width: 1.5px;
                border-style: solid;
			}
            .CodeMirror{
                font-size: 13px;
                font-family: 'JetBrains Mono', monospace;
                height: 80vh;
            }
            .CodeMirror-scroll {
                overflow-y: scroll;
                overflow-x: auto;
            }
            button{
                transition: all ease-in-out 0.3s;
            }
            select{
                outline: none;
                transition: all ease-in-out 0.3s;
            }
		</style>
	</head>
	<body>
		<p class="
        text-white text-lg 
        ">Dynamical JS</p>

        <div class="
        flex space-x-6 justify-center
        mb-10
        text-white
        w-[10vw]
        ">
            <a href="/">Home</a>
            <a class="text-[#88C0D0]">Example</a>
            <a href="/about.html">About</a>
        </div>

        <div>
            <div class="flex">
                <div>
                    <canvas class="m-5 w-[30vw] h-[30vw]"></canvas>

                    <div class="flex">
                        <button id="render-button" class="text-[#2E3440] bg-[#A3BE8C]
                        font-bold 
                        hover:px-5 hover:py-3 
                        px-4 py-2 ml-5 rounded">Render</button>
                        <select id="select" class="
                        text-white bg-transparent
                        px-5 mx-5
                        font-bold
                        rounded
                        hover:text-[#88C0D0]
                        ">
                        </select>
                    </div>
                </div>

                <div name="editor">
                    <textarea id="editor">
                    </textarea>
                </div>

            </div>
        </div>

        <script type="module">
            import Renderer from '../src/renderer.js';
            import { Vector2 } from '../src/util/vector.js';
            import PointMass from '../src/point_mass.js';
            import { RigidConstraint, BoxConstraint, SpringConstraint } from '../src/constraint.js';

            const examples = {
                cube: `
const renderer = new Renderer(canvas[0]);
renderer.setBackground('#2E3440');

const square = [
    new PointMass(renderer.CENTER.add(new Vector2(0, -100))),
    new PointMass(renderer.CENTER.add(new Vector2(100,0))),
    new PointMass(renderer.CENTER.add(new Vector2(0, 100))),
    new PointMass(renderer.CENTER.add(new Vector2(-100, 0))),
];
const square_structure = new RigidConstraint([...square, square[0], square[2]]);

const canvas_container = new BoxConstraint( renderer.WIDTH, renderer.HEIGHT, square);

renderer.update(({delta_time, context:c})=>{
    renderer.clear();

    for(let i=0; i<square.length; i++){
        square[i].applyForce(new Vector2(0, 9.8 * square[i].mass));
    }


    for(let iteration=0; iteration<4; iteration++){
        square_structure.check();
        canvas_container.check();
        for(let i=0; i<square.length; i++){
            square[i].updatePosition(delta_time*0.55);
        }
    }

    renderer.polygon(square, {fill:"#D08770"});
});
                `,
                bridge: `const renderer = new Renderer(canvas[0]);
renderer.setBackground('#2E3440');

const l = 150;

const p1 = [
	new PointMass(renderer.CENTER.add(new Vector2(-l/2, -l/3))),
	new PointMass(renderer.CENTER.add(new Vector2(l/2, -l/3))),
];

const p2 = [
	new PointMass(renderer.CENTER.add(new Vector2(-l, l/3)), {is_static: true}),
	new PointMass(renderer.CENTER.add(new Vector2(0, l/3))),
	new PointMass(renderer.CENTER.add(new Vector2(l, l/3)), {is_static: true}),
];

const P = new PointMass(renderer.CENTER.add(new Vector2(l/1.2, l/3)));

const r1 = new RigidConstraint([p2[0], p1[0], p2[1], p1[1], p2[2]]);
const r2 = new RigidConstraint([p2[0], p2[1], p2[2]]);
const r3 = new RigidConstraint([p1[0], p1[1]]);
const r4 = new RigidConstraint([p2[1], P]);

const canvas_container = new BoxConstraint( renderer.WIDTH, renderer.HEIGHT, []);

renderer.update(({delta_time, context:c})=>{
	renderer.clear();

  	for(let i=0; i<p1.length; i++){
    	p1[i].applyForce(new Vector2(0, 9.8));
    }
  	p2[1].applyForce(new Vector2(0, 9.8));
  	P.applyForce(new Vector2(0, 9.8));
  
    for(let iteration=0; iteration<4; iteration++){
        r1.check();
        r2.check();
        r3.check();
        r4.check();
        for(let i=0; i<p1.length;i++){
            p1[i].updatePosition(delta_time*0.55);
        }
        p2[1].updatePosition(delta_time*0.55);
        P.updatePosition(delta_time*0.55);
    }
  
  	c.fillStyle = '#EBCB8B';
  	for(let i=0; i<p1.length; i++){
    	renderer.point(p1[i].position, 10);
    }
  	for(let i=0; i<p2.length; i++){
    	renderer.point(p2[i].position, 10);
    }
  	renderer.point(P.position, 10);
  
  	c.strokeStyle = '#A3BE8C';
  	for(let i=1; i<r1.points.length; i++){
    	renderer.line(r1.points[i-1].position, r1.points[i].position);
    }
  	for(let i=1; i<r2.points.length; i++){
    	renderer.line(r2.points[i-1].position, r2.points[i].position);
    }
  	for(let i=1; i<r3.points.length; i++){
    	renderer.line(r3.points[i-1].position, r3.points[i].position);
    }
    renderer.line(r4.points[0].position, r4.points[1].position);
});
                    `};

            const select_ele = document.getElementById('select');
            for(let name in examples){
                select_ele.innerHTML = select_ele.innerHTML 
                + `<option>${name}</option>`;
            }

            const canvas = document.getElementsByTagName('canvas');

            const editor = document.getElementById("editor");
            const cm = CodeMirror.fromTextArea(editor, {
                mode: "javascript",
                lineNumbers: true,
                viewportMargin: Infinity,
                theme: "nord",
            });
            cm.highlighter = function(text, options) {
                return Prism.highlight(text, Prism.languages.javascript, 'javascript');
            };

            cm.setValue(examples[select_ele.value]);
            render();

            select_ele.addEventListener('change', (e)=>{
                cm.setValue(examples[e.target.value]);
                render();
            });

            document.getElementById('render-button').addEventListener('click', ()=>{
                render();
            });
            function render(){
                eval(cm.getValue());
            }
        </script>

	</body>
</html>
